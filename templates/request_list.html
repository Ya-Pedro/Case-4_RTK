{% extends 'base.html' %}
{% block content %}
<h3>Заявки</h3>
<table class="table">
  <thead><tr><th>Сотрудник</th><th>Период</th><th>Тип</th><th>Статус</th><th>Комментарий</th><th>Действия</th></tr></thead>
  <tbody>
  {% for r in requests %}
    <tr>
      <td>{{ services.get_user_by_id(r.user_id).full_name }}</td>

      <td>
        {{ r.start_date }} → {{ r.end_date }}
      </td>

      <td>{{ r.type }}</td>

      <td>
        {% if r.status == 'pending' %}
          <span class="badge bg-warning text-dark">На рассмотрении</span>
        {% elif r.status == 'approved' %}
          <span class="badge bg-success">Согласовано</span>
        {% elif r.status == 'rejected' %}
          <span class="badge bg-danger">Отклонено</span>
        {% elif r.status == 'cancelled' %}
          <span class="badge bg-secondary">Отменено</span>
        {% else %}
          <span class="badge bg-light text-dark">{{ r.status }}</span>
        {% endif %}
      </td>

      <td>
        {{ r.comment or '—' }}
      </td>

      <td>
        {% if current_user.role == 'employee'
              and r.user_id == current_user.id
              and r.status == 'pending' %}
          <form method="post"
                action="/request/cancel"
                style="display:inline">
            <input type="hidden" name="id" value="{{ r.id }}">
            <button type="submit"
                    class="btn btn-sm btn-outline-danger"
                    onclick="return confirm('Вы уверены, что хотите отменить заявку?')">
              Отменить
            </button>
          </form>
        {% else %}
          —
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

{% if not requests %}
  <div class="alert alert-info mt-3">
    Заявок пока нет
  </div>
{% endif %}

{% endblock %}